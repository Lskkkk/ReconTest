<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../resource/jquery.js"></script>
    <script src="../resource/echarts.min.js"></script>
    <script src="./handledData/all.js"></script>
</head>

<body>
    <div id="main" style="width: 80%;height:50%;min-height: 500px;"></div>

    <script type="text/javascript">
        const mainChart = echarts.init(document.getElementById('main'));
        const formatDay = day => `${day.substring(0, 4)}-${day.substring(4, 6)}-${day.substring(6, 8)}`;

        const startDay = '20150105';
        const series = Object.keys(allFunds).map(fund => {
            return {
                name: fund,
                type: 'line',
                showSymbol: false,
                data: Object.keys(allFunds[fund]).filter(day => day >= startDay).map(day => {
                    const startValue = allFunds[fund][startDay];
                    return [formatDay(day), Number((allFunds[fund][day] / startValue).toFixed(4))];
                })
            };
        });
        const avg = {
            name: 'AVG',
            type: 'line',
            showSymbol: false,
            data: []
        };
        const fundsNames = ["中证中金优选300全收益指数", "中证东方红红利低波动全收益指数", "中证东方红红利低波动全收益指数"];
        // const fundsNames = Object.keys(allFunds);
        let startValue = 1000000000;
        Object.keys(allFunds[fundsNames[0]]).filter(day => day >= startDay).forEach(day => {
            const allValues = fundsNames.map(fundName => allFunds[fundName][day]);
            const currentValue = Number((allValues.reduce((s, pv) => s += pv, 0) / fundsNames.length).toFixed(4));
            if (day == startDay) {
                startValue = currentValue;
                console.log(day, startValue);
            }
            avg.data.push([formatDay(day), Number((currentValue / startValue).toFixed(4))]);
            // console.log(day, avg.data[avg.data.length - 1]);
        });
        series.push(avg);

        const option = {
            title: {
                text: '历史净值(百分比)'
            },
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: ['点数']
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            toolbox: {
                feature: {
                    saveAsImage: {}
                }
            },
            xAxis: {
                type: 'time',
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                type: 'value',
                boundaryGap: [0, '100%'],
                splitLine: {
                    show: false
                }
            },
            dataZoom: [
                {
                    type: 'slider', // 使用滑块类型
                    start: 0, // 初始化滑块开始位置（百分比）
                    end: 100, // 初始化滑块结束位置（百分比）
                    handleSize: '80%', // 滑块手柄的大小
                    handleStyle: {
                        color: '#000',
                        shadowBlur: 3,
                        shadowColor: 'rgba(0, 0, 0, 0.6)',
                        shadowOffsetX: 2,
                        shadowOffsetY: 2
                    }
                }
            ],
            series
        };
        mainChart.setOption(option);
        console.log(allFunds);
    </script>
</body>

</html>